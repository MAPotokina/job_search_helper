---
alwaysApply: true
---

# Code Conventions - Job Search Helper

> Development rules for code assistant. Based on [vision.md](vision.md).

## Philosophy

**KISS (Keep It Simple, Stupid)** - main principle. Simplicity > complexity.

## Code Structure

### Files and Modules
- **One file = one responsibility**: `models.py` only models, `llm.py` only LLM
- **Flat structure**: everything in `app/`, no nested packages
- **All endpoints in `main.py`**: no routers, no file separation

### Naming
```python
# Variables and functions - snake_case
job_description = "..."
def analyze_visa_sponsorship():

# Classes - PascalCase
class Job(Base):

# Constants - UPPER_CASE (only in config.py)
OPENAI_MAX_TOKENS = 1000
```

## Database (SQLAlchemy)

```python
# ✅ Simple models, minimal relationships
class Job(Base):
    __tablename__ = "jobs"
    id = Column(Integer, primary_key=True)
    title = Column(String(200), nullable=False)
    # ...

# ✅ Direct queries
jobs = db.query(Job).filter(Job.status == "applied").all()

# ❌ DO NOT create complex relationships (relationships, joins)
# ❌ DO NOT use complex query builder patterns
```

## LLM Integration

```python
# ✅ Use prompts from prompts.py
from app.prompts import PROMPTS
prompt = PROMPTS["visa_sponsorship"]

# ✅ Always log calls to llm_logs table
log_llm_call(function_name, status, execution_time, tokens_used)

# ✅ Truncate long texts
if len(text) > MAX_JOB_DESCRIPTION_LENGTH:
    text = text[:MAX_JOB_DESCRIPTION_LENGTH]

# ✅ Handle errors - return HTTP error codes
except Timeout:
    raise HTTPException(status_code=504, detail="OpenAI timeout")

# ❌ DO NOT do retry for MVP
# ❌ DO NOT use async for LLM calls
```

## API Endpoints

```python
# ✅ REST standard
@app.get("/api/jobs")           # get list
@app.post("/api/jobs")          # create
@app.put("/api/jobs/{id}")      # update
@app.delete("/api/jobs/{id}")   # delete

# ✅ Pydantic schemas for validation
def create_job(job: JobCreate):
    # minimal validation via Pydantic

# ✅ Proper HTTP codes
return JSONResponse(status_code=201, content=...)

# ❌ DO NOT create middleware
# ❌ DO NOT use dependency injection more complex than needed
```

## Configuration and Logging

```python
# ✅ Configuration imports
from app.config import OPENAI_API_KEY, MAX_TOKENS
from app.prompts import PROMPTS

# ✅ Logging (console only)
import logging
logger = logging.getLogger(__name__)
logger.info("Job created successfully")
logger.error(f"OpenAI API error: {error}")

# ❌ DO NOT log full texts (job descriptions, resumes, cover letters)
# ❌ DO NOT log API keys and secrets
```

## Date Handling

```python
# ✅ Auto-fill on status change
if new_status == "applied" and not job.applied_date:
    job.applied_date = datetime.now()

if new_status in ["offer", "rejected"] and not job.response_date:
    job.response_date = datetime.now()
    # Automatically calculate
    job.days_to_response = (job.response_date - job.applied_date).days
```

## Frontend

```python
# ✅ Vanilla JavaScript - no frameworks
# ✅ Fetch API for requests
fetch('/api/jobs')
    .then(res => res.json())
    .then(data => renderJobs(data))

# ❌ DO NOT use React/Vue/Angular
# ❌ DO NOT use bundlers (webpack, vite)
```

## What is FORBIDDEN for MVP

- ❌ Authentication/authorization
- ❌ Tests (will add later)
- ❌ Middleware
- ❌ Caching
- ❌ Async where not needed (only in FastAPI endpoints)
- ❌ Complex patterns (Factory, Strategy, Observer)
- ❌ Routers, services, repositories - everything in main.py
- ❌ Docker, CI/CD, deployment scripts

## Error Handling

```python
# ✅ Simple try-except with HTTP errors
try:
    result = call_openai_api(...)
except Timeout:
    raise HTTPException(status_code=504, detail="OpenAI timeout")
except APIError as e:
    raise HTTPException(status_code=503, detail=str(e))

# ❌ DO NOT create custom exception classes
# ❌ DO NOT implement retry logic
```

## Comments

```python
# ✅ Minimal comments - code should be self-explanatory
# ✅ Comment only non-obvious things (e.g., why we truncate text)

# Truncate to 5000 characters due to OpenAI limit
text = text[:MAX_JOB_DESCRIPTION_LENGTH]

# ❌ DO NOT comment obvious things
# Create job
job = Job(title=title)  # ❌ bad
```

## Main Rule

**If unsure - choose the simplest solution.**

See [vision.md](vision.md) for details on architecture, data model and usage scenarios.

